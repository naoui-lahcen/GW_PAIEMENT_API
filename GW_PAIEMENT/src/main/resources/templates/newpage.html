<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GATEWAY NAPS</title>

    <!-- CSS -->
    <link crossorigin="anonymous"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
          rel="stylesheet">
    <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css"
          rel="stylesheet">
    <link rel="icon" type="image/png" href="https://naps.ma/wp-content/uploads/2024/06/cropped-favicon-32x32-1-32x32.png">

    <!-- JS -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous" defer></script>
    <style>

        .dropdown-item.selected {
            background-color: #f9f9f9;
            border-radius: 8px;
        }

        .dropdown-item .checkmark {
            display: inline-block;
            width: 16px;
            height: 16px;
            background-image: url('/images/check-orange.svg');
            background-size: contain;
            background-repeat: no-repeat;
            visibility: hidden;
        }

        .dropdown-item.selected .checkmark {
            visibility: visible;
        }


        .custom-checkbox-wrapper input[type="checkbox"] {
                display: none;
            }

            /* Flex layout */
            .custom-checkbox-wrapper {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            /* Custom square box */
            .custom-checkbox-style {
                width: 20px;
                height: 20px;
                border: 2px solid #ccc;
                border-radius: 6px;
                background-color: #fff;
                display: inline-block;
                position: relative;
                transition: all 0.2s ease;
            }

            /* Checkmark */
            .custom-checkbox-style::after {
                content: "";
                position: absolute;
                display: none;
                left: 5px;
                top: 1px;
                width: 6px;
                height: 12px;
                border: solid #fd7e14;
                border-width: 0 2px 2px 0;
                transform: rotate(45deg);
            }

            /* Checked state styles */
            .custom-checkbox-wrapper input[type="checkbox"]:checked + label .custom-checkbox-style {
                background-color: #fff5f0;
                border-color: #fd7e14;
            }

            .custom-checkbox-wrapper input[type="checkbox"]:checked + label .custom-checkbox-style::after {
                display: block;
            }

            /* Label text styling */
            .custom-checkbox-label-text {
                font-size: 14px;
            }

            .custom-checkbox-container {
                   display: flex;
                   align-items: center;
               }

               .custom-checkbox-container input[type="checkbox"] {
                   display: none;
               }

               .custom-checkbox {
                   width: 20px;
                   height: 20px;
                   border: 2px solid #ccc;
                   border-radius: 6px;
                   background-color: #fff;
                   display: inline-block;
                   position: relative;
                   margin-right: 10px;
                   cursor: pointer;
               }

               .custom-checkbox::after {
                   content: "";
                   position: absolute;
                   display: none;
                   left: 5px;
                   top: 1px;
                   width: 6px;
                   height: 12px;
                   border: solid #fd7e14;
                   border-width: 0 2px 2px 0;
                   transform: rotate(45deg);
               }

               input[type="checkbox"]:checked + label .custom-checkbox {
                   border-color: #fd7e14;
                   background-color: #fff5f0;
               }

               input[type="checkbox"]:checked + label .custom-checkbox::after {
                   display: block;
               }

               .custom-checkbox-label {
                   display: flex;
                   align-items: center;
                   cursor: pointer;
               }

               .custom-checkbox-label .terms-link {
                   text-decoration: underline;
                   cursor: pointer;
                   margin-left: 5px;
               }

               /* ✅ MODAL STYLE */
               .modal-overlay {
                   display: none;
                   position: fixed;
                   top: 0; left: 0;
                   width: 100%; height: 100%;
                   background-color: rgba(0, 0, 0, 0.5);
                   z-index: 9999;
                   overflow: hidden;
               }

               .modal-content {
                   background-color: white;
                   width: 90%;
                   max-width: 650px;
                   max-height: 90vh; /* restrict height */
                   margin: 5vh auto;
                   padding: 25px;
                   border-radius: 10px;
                   position: relative;
                   overflow-y: auto; /* allow scroll if content exceeds */
                   box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
               }

               .modal-content::-webkit-scrollbar {
                   width: 8px;
               }
               .modal-content::-webkit-scrollbar-thumb {
                   background-color: #ccc;
                   border-radius: 4px;
               }


               .modal-content h3 {
                   color: #fd7e14;
                   margin-bottom: 15px;
               }

               .modal-close {
                   position: absolute;
                   top: 10px; right: 15px;
                   font-size: 20px;
                   cursor: pointer;
               }
        div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel) {
            border-radius: 8px !important;
            background-color: #ffffff !important;
            box-shadow: var(--swal2-cancel-button-box-shadow);
            color: #000000 !important;
            border: 1px solid #D5D7DA !important;
        }

        div:where(.swal2-container) h2:where(.swal2-title) {
                    font-size: 1.2em !important;
                }

        .custom-dropdown {
            position: relative;
            user-select: none;
            font-family: Arial, sans-serif;
        }


         .selected-card {
           height:38px;
       border: 1px solid #ccc;
       padding: 8px 12px;
       cursor: pointer;
       display: flex;
       align-items: center;
       justify-content: space-between;
       background-color: white;
       border-radius: 5px !important;

    }


        .dropdown-list .dropdown-item:hover {
            background-color: #f0f0f0;

        }



        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f8f9fc;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
        }

        /* Conteneur principal (PLEIN ÉCRAN) */
        .container {
            display: flex;
            width: 100vw;
            height: 100vh;
            background: white;
            border-radius: 0;
            overflow: hidden;
        }

        input::placeholder {
            font-family: 'Arial', sans-serif;
            color: var(--Gray-500, #667085);
            font-size: 14px;
            font-style: normal;
            font-weight: 300;
            line-height: 24px;
        }
        input:focus {
            border: 2px solid #add2fa !important;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
            outline: none;
        }

       .form-group {
            margin-bottom: 15px;
       }
       .form-group label {
           display: block;
           margin-bottom: 5px;
       }
       .form-group input, select {
           width: 100%;
           padding: 8px;
           border: 1px solid #ccc;
           border-radius: 5px;
       }

        /* SECTION GAUCHE - Détails transaction */
        .left-panel {
            background: linear-gradient(181deg, #FF5E00 0.57%, rgba(255, 69, 0, 0.70) 98.77%, #570001 134.01%), #000;
            color: white;
            padding: 50px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex: 1;
            width: 100%;
            /*width: 588px;*/
            /*height: 982px;*/
            height: 1020px;
            flex-shrink: 0;
        }

        .total {
            font-size: 22px;
            margin-top: 20px;
        }

        .total span {
            font-size: 36px;
            font-weight: bold;
        }
        .detsimg {
            margin-bottom: 25px;
        }
        .icondetails {
            width: 120px;
        }
        .details p {
            margin: 15px 0;
            font-size: 16px;
        }

        .details a {
            color: white;
            text-decoration: underline;
        }

        /* SECTION DROITE - Formulaire paiement */
        .payment-panel {
            padding: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background-color: #F9FAFB;
            border-radius: 0;
            flex: 2;
            display: inline-flex;
            padding: 133px 197px 51px 197px;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            gap: 251px;
        }

        .payment-header {
            display: flex;
            align-items: center;
            margin-bottom: 124px;
            margin-bottom: 100px;
        }
        .formm {
            width: 530px;
            margin-top: -35px;
            margin-top: -110px;
        }

        .icon-container {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            border-style: solid;
            border: 1px solid #EAECF0;
            background-color: #FFFFFF;
        }

        .icon-container i {
            font-size: 24px;
            color: #2d3748;
        }

        .text-container h3 {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }

        .text-container p {
            line-height: 0.2;
            line-height: 0.9;
            margin: 2px 0 0;
            font-size: 14px;
            font-size: 15px;
            color: #718096;
        }

        .payment-form label {
            display: block;
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
        }

        .payment-form input {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        .card-input {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            border: 1px solid #ccc;
            padding: 12px;
            border-radius: 5px;
        }

        .card-input img {
            height: 25px;
        }

        .card-details {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .card-details input {
            flex: 1;
        }

        .terms {
            display: flex;
            align-items: center;
            margin-top: 15px;
            font-size: 14px;
        }

        .terms input {
            margin-right: 10px;
        }

        .terms a {
            color: #ff6b00;
            text-decoration: none;
        }

        .pay-button {
            width: 100%;
            padding: 15px;
            background: #ff6b00;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }

        .pay-button:hover {
            background: #e65a00;
        }

        .secure-info {
            text-align: center;
            font-size: 14px;
            color: #718096;
            margin-top: 15px;
        }
        .sec {
            font-family: sans-serif, Arial;
            font-weight: 400;
            line-height: 20px;
            color: #677489;
        }

        footer {
            text-align: center;
            font-size: 14px;
            margin-top: 20px;
            color: #718096;
        }

        footer a {
            color: #ff6b00;
            text-decoration: none;
        }

             body {
                   width: 100vw;
                   background-color: #F9FAFB;
                }
               .container {
                   display: flex;
                   width: 100%;
                   height: 100%;
                   max-width: none;
               }

               .toggle-btn {
                   background: #FF5F00;
                   color: white;
                   font-size: 24px;
                   border: none;
                   border-radius: 50%;
                   width: 40px;
                   height: 40px;
                   position: fixed;
                   top: 20px;
                   right: 20px;
                   cursor: pointer;
                   z-index: 5;
               }
              .toggle-btn {
                 display: none;
              }
                .left-panel .details {
                    display: flex;
                    flex-direction: column;
                    align-items: flex-start;
                    text-align: left;
                    width: inherit;
                    margin-top: 85px;
                    margin-left: 10%;
                    margin-right: 10%;
                }
                .left-panel .sidbar {
                    margin-left: 10%;
                    margin-right: 10%;
                }
                .left-panel .details p {
                    font-size: 20px;
                    line-height: 2;
                    margin-bottom: 20px;
                }
                .form-group input[type="checkbox"] {
                    width: 18px;
                    height: 18px;
                }
                .text-infos {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }
                .text-content {
                    display: flex;
                    flex-direction: column;
                }
                .details-message {
                    display: none;
                }
                .labInput {
                    font-family: Inter, sans-serif;
                    font-weight: 500;
                    font-size: 14px;
                    line-height: 20px;
                    letter-spacing: 0%;
                    color: #344054;

                }
                #error-message {
                    font-family: sans-serif, Arial;
                    display: flex;
                    width: 530px;
                    padding: 16px;
                    align-items: center;
                    gap: 12px;
                    border-radius: 12px;
                    border: 1px solid var(--Error-300, #FDA29B);
                    background: var(--Error-25, #FFFBFA);
                    color: #D92D20;
                    margin-top: -82px;
                    margin-bottom: 30px;
                    font-size: 14px;
                    font-style: normal;
                    font-weight: 600;
                    line-height: 20px;
                }
                .lock-label {
                    overflow: hidden;
                    text-overflow: ellipsis;
                    justify-content: center;
                    font-family: sans-serif, Arial;
                    font-weight: 400;
                    line-height: 20px;
                    color: #677489;
                }
                .sec {
                    margin-left: 4px;
                    font-family: sans-serif, Arial;
                    color: #677489;
                    font-size: 14px;
                    font-style: normal;
                    font-weight: 400;
                    line-height: 20px;
                }
                .footer-content {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    font-family: sans-serif, Arial;
                    font-weight: 400;
                    line-height: 18px;
                    color: #677489;
                    margin-top: auto;
                    width: 100%;
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    padding: 10px 0;
                }
                .separator {
                    margin: 0 5px;
                    color: #adb5bd;
                }
                .textFooter {
                    font-family: Arial, sans-serif;
                    color: #6C6C84;
                    font-size: 12px;
                    font-style: normal;
                    font-weight: 400;
                }
                .logoMbl {
                    display: none;
                }
                .logo .navg {
                  /*margin-left: 37px;
                  margin-top: 25px;*/
                }
                .logo .mbl {
                  display: none;
                }
                .flex-container {
                    margin-top: 50px;
               }
                .text-infos .frame {
                    border-radius: 10px;
                    padding: 5px;
                    border-style: solid;.text-content
                    background-color: #FFFFFF;
                    border: 1px solid #EAECF0;
                    width: 48px;
                    height: 48px;
               }
                .numcarte {
                    position: relative;
                    display: flex;
                    align-items: center;
                }
                .numcarte1 {
                    position: relative;
                    display: flex !important;
                    align-items: center;
                }
                .numcarte input {
                    width: 100%;
                    padding-right: 40px;
                    height: 40px;
                }
                .numcarte img {
                    position: absolute;
                    right: 10px;
                    width: 30px;
                    height: auto;
                    display: block;
                }
                #card-logo {
                    position: absolute;
                    right: 10px;
                    width: auto;
                    height: auto;
                    display: block;
                }
                #card-logo1 {
                    position: absolute;
                    right: 10px;
                    width: auto;
                    height: auto;
                    display: block;
                }

                #card-logo2 {
                    position: absolute;
                    right: 40px;
                    width: auto;
                    height: auto;
                    display: block;
                }
                .cvc {
                    position: relative;
                    display: flex;
                    align-items: center;
                }
                .cvc img {
                    position: absolute;
                    right: 10px;
                    width: 30px;
                    height: auto;
                }
                .textFooter img {
                    width: 45px;
                    height: 18px;
                }
                .col-md-5 {
                    padding-right: 0;
                    padding-left: 0;
                }
                   .total-box {
                        color: white;
                        border-radius: 10px;
                        font-family: Arial, sans-serif;
                        width: fit-content;
                    }

                    .total-box .label {
                        font-size: 14px;
                        opacity: 0.8;
                    }

                    .total-box .amount {
                        font-size: 32px;
                        font-size: 40px;
                        font-weight: bold;
                        font-family: Inter,sans-serif;
                    }

                    .total-box .currency {
                        font-size: 14px;
                        font-size: 20px;
                        margin-left: 5px;
                        color: #FFF;
                        font-family: "DM Sans";
                        font-style: normal;
                        font-weight: 400;
                    }

                    .details {
                        font-family: Arial, sans-serif;
                    }

                .details h2 {
                    margin-bottom: 30px;
                    font-family: Arial, sans-serif;
                    font-weight: 600;
                    font-size: 18px;
                }

                .transaction-item {
                    display: flex;
                    align-items: center;
                    margin-bottom: 20px;
                }

                .transaction-item i {
                    font-size: 18px;
                    margin-right: 10px;
                    opacity: 0.8;
                }

                .transaction-item label {
                    font-family: Arial, sans-serif;
                    font-weight: 500;
                    font-size: 16px;
                    line-height: 24px;
                    letter-spacing: 0%;
                    text-align: center;
                    margin: 0;
                }
                .transaction-item .value {
                    margin: 0 30px;
                    border-radius: 5px;
                    color: #FFF;
                    font-family: Arial, sans-serif;
                    font-size: 16px;
                    font-style: normal;
                    font-weight: 500;
                    line-height: 24px;
                }
                .subscribe-btn {
                       width: 100%;
                       padding: 10px;
                       background: #FF5F00;
                       cursor: pointer;
                       font-weight: 500;
                       font-size: 18px;
                       line-height: 28px;
                       font-family: sans-serif, Arial;
                       font-style: normal;
                       color: #FFFFFF;
                       border-radius: 8px;
                       border: 1px solid #FF5F00;
                       box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
                   }
                   .montant {
                        font-family: sans-serif, Arial;
                        font-weight: 700;
                        font-size: 18px;
                        line-height: 28px;
                   }
                   .curr {
                        font-family: sans-serif, Arial;
                        font-weight: 700;
                        font-size: 18px;
                        line-height: 28px;
                   }

                   /* RESPONSIVE */
                   @media (max-width: 768px) {
                       .container {
                            flex-direction: column;
                       }
                       .subscribe-btn {
                            width: 95%;
                            font-weight: 600;
                            font-size: 16px;
                        }
                        .toggle-btn:focus {
                            outline: none;
                        }
                       .logo {
                            display: none;
                       }
                       .logoMbl {
                            display: block;
                            margin-top: 15px;
                            position: fixed;
                            margin-left: 15px;
                        }
                    .left-panel {
                        width: 100%;
                        text-align: center;
                        align-items: center;
                        padding: 17px 20px;
                        width: 100%;
                        position: fixed !important;
                        top: 49px !important;
                        height: auto;
                        z-index: 10;
                        background: linear-gradient(181deg, #FF5E00 0.99%, rgba(255, 69, 0, 0.70) 186.23%, #570001 375.93%), #000;
                        width: 100%;
                        height: auto;
                        flex-shrink: 0;
                    }
                    .payment-header {
                        display: block;
                        margin-bottom: 20px;
                    }
                    .icon-container {
                        width: 48px;
                        height: 48px;
                    }
                    .text-container {
                        margin-top: 10px;
                        width: 350px;
                    }

                    .text-container p {
                        line-height: normal;
                    }
                       .toggle-btn {
                           display: block;
                           top: 58px;
                           margin-right: -12px;
                           z-index: 11;
                           background: none;
                       }
                       .logo {
                            background-color: #F9FAFB;
                            margin-top: 25px;
                       }
                       .logo .mbl {
                            display: block;
                            height: 24px;
                            margin-left: 30px;
                            position: relative;
                            top: -10px;
                            margin-left: 36px;
                       }
                       .logo .navg {
                          display: none;
                        }
                        .text-infos {
                            display: block;
                            margin: 0px;
                        }
                        #error-message {
                            display: flex;
                            width: 100%;
                            padding: 16px;
                            align-items: center;
                            gap: 12px;
                            border-radius: 12px;
                            border: 1px solid var(--Error-300, #FDA29B);
                            background: var(--Error-25, #FFFBFA);
                            color: #D92D20;
                            margin-top: 0px;
                            font-size: 14px;
                            font-style: normal;
                            font-weight: 600;
                            line-height: 20px;
                        }
                       .payment-panel {
                         top: 49px;
                         top: 55px;
                         top: 115px;
                         position: relative;
                         width: 100%;
                         padding: 15px;
                         padding: revert-layer;
                         gap: 0px;
                       }
                       .flex-container {
                            display: flex;
                            justify-content: space-between;
                            width: 100%;
                            height: 20px;
                            margin-top: 0px;
                       }
                       .left-panel .details {
                            text-align: left;
                            /*padding: 10px;*/
                            display: none;
                            /*margin-top: 0;*/
                            margin-top: 20px;
                         }
                         .detsimg {
                            display: none;
                         }
                         .left-panel .details p {
                            font-size: 14px;
                            line-height: 1.4;
                            margin-bottom: 10px;
                        }
                        .left-panel h2 {
                           font-size: 16px;
                         }
                         .details-message {
                            font-size: 14px;
                            display: block;
                            margin-right: 30px;
                            white-space: nowrap;
                            color: #FFFFFF;
                            font-family: Arial, sans-serif;
                        }
                        .transaction-item label {
                            font-size: 14px;
                        }
                        .transaction-item .value {
                            border-radius: 6px;
                            background: rgba(255, 255, 255, 0.04);
                            font-size: 14px;
                            margin-right: auto;
                            min-width: 171px;
                        }
                        .details h2 {
                            margin-bottom: 20px;
                        }
                        .dhs {
                            font-style: normal;
                            line-height: 24px;
                        }
                        .total-box {
                            margin-left: 0;
                            margin-top: -5px;
                        }
                        .total-box .label {
                            display: none;
                        }
                        .total-box .amount {
                            font-size: 16px;
                            font-size: 20px;
                            font-weight: bold;
                        }
                        .montant {
                            font-style: normal;
                            line-height: 24px;
                        }
                        .montant {
                            font-weight: 600;
                            font-size: 16px;
                       }
                       .curr {
                            font-weight: 600;
                            font-size: 16px;
                       }

                        .total-box .currency {
                            font-size: 12px;
                            font-size: 14px;
                            margin-left: 5px;
                        }
                         .payment-panel h2, h3, h4, h5 {
                            font-size: 16px;
                        }
                        .form-group.d-flex {
                            white-space: nowrap;
                            overflow: hidden;
                            text-overflow: ellipsis;
                            font-size: 14px;
                        }
                         .transaction-item {
                            margin-bottom: 13px;
                        }
                        .form-group .enter {
                            font-size: 14px;
                        }
                         .form-group.lock-label {
                            white-space: normal;
                            overflow: hidden;
                            text-overflow: ellipsis;
                        }
                        .sec {
                            font-size: 12px;
                        }
                        .footer {
                            text-align: center;
                            top: 495px;
                            position: fixed;
                        }
                        .footer-content {
                            flex-direction: column;
                            align-items: center;
                            margin-top: 25px;
                            width: 100%;
                            position: relative;
                            padding: 0;
                        }
                         .policy-links {
                            align-self: flex-start;
                            text-align: left;
                            width: 100%;
                            font-size: 14px;
                            margin: 8px;
                            margin-top: 15px;
                        }
                        .textFooter {
                            font-size: 12px;
                        }
                        .formm {
                            width: auto;
                            width: 95%;
                            margin-top: 0px;
                        }
                        .row.h-100 {
                            height: auto !important;
                        }
                         .custom-checkbox-label {
                             font-size: 13px;
                        }

                       .custom-checkbox-label .terms-link {
                           margin-left: 3px;
                       }
                        .custom-checkbox {
                           margin-right: 5px;
                        }

                      }

                .custom-left-panel {
                  flex: 0 0 40%;
                  max-width: 40%;
                }

                .payment-panel {
                  flex: 0 0 60%;
                  max-width: 60%;
                }

                @media (max-width: 767.98px) {
                  .custom-left-panel,
                  .payment-panel {
                    flex: 0 0 100%;
                    max-width: 100%;
                    margin: auto;
                  }
                }

                .expired-card {
                  color: red;
                }

                .card-number {
                    font-family: Font family/font-family-body;
                    font-weight: 500;
                    font-size: Font size/text-md;
                    line-height: Line height/text-md;
                    letter-spacing: 0%;
                }

                input:focus,
                input.form-control:focus {
                    border-color: #FDA29B !important;
                    box-shadow: none;
                    outline: none !important;
                }

                #selectedText{
                    font-weight: 478;
                    font-size: 24;
                }

                .swal-toast {
                  display: flex !important;
                  align-items: center;
                  gap: 12px;
                  font-size: 1rem;
                  border-radius: 12px;
                  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
                  white-space: nowrap;
                  max-width: none;
                  overflow: hidden;        /* hides any extra content that overflows */
                  max-width: 100%;         /* ensures it doesn't exceed parent container */
                  width: fit-content;      /* just fits the content without stretching */
                  box-sizing: border-box;
                }

                .swal-toast-center .swal2-image {
                  margin: 0 !important;
                }

                body.swal2-toast-shown .swal2-container {
                    width: 415px !important;
                }

                .rotate-180 {
                  transform: rotate(-180deg);
                  transition: transform 0.3s ease;
                }

                .rotate-0 {
                  transform: rotate(0deg);
                  transition: transform 0.3s ease;
                }


    </style>
</head>
<body>

<div class="container-fluid h-100">
    <!-- SECTION GAUCHE -->
    <div class="row h-100">
        <img alt="Image" class="logoMbl" th:src="@{/images/logo_naps_mb.svg}">
        <div class="row d-flex flex-row custom-left-panel">
            <div class="left-panel d-flex flex-column">
                <div class="sidbar content-wrapper d-flex flex-column w-100">
                    <div class="logo">
                        <img alt="Image" class="navg" th:src="@{/images/logo_naps_nav.svg}">
                    </div>
                    <div class="flex-container">
                        <div class="total-box">
                            <div class="label">Total</div>
                            <div>
                                <span class="amount" th:text="${demandeDto.montantStr}"></span>
                                <span class="dhs">DH</span>
                            </div>
                        </div>
                        <p class="details-message"><img alt="Image" class="affich_dets" th:src="@{/images/affich_dets.svg}"></p>
                    </div>
                </div>


                <button class="toggle-btn" onclick="togglePanel()">
                    <!--<img alt="Image" class="flech" th:src="@{/images/flechBas.svg}">-->
                    <img alt="Flèche bas" class="flech down" th:src="@{/images/flechBas.svg}">
                    <img alt="Flèche haut" class="flech up d-none" th:src="@{/images/flechHaut.svg}">
                </button>

                <div class="details">

                    <!--<h2>Détails de votre transaction</h2>-->
                    <div class="detsimg">
                        <img alt="Image" class="dets" th:src="@{/images/detailsTrs.svg}">
                    </div>

                    <div class="transaction-item">
                        <!--<img alt="Image" class="date" th:src="@{/images/icondate.svg}">
                        <label>Date</label>-->
                        <div class="icondetails"><img alt="Image" class="dets" th:src="@{/images/iconetdate.svg}"></div>
                        <div class="value"><span th:text="${formattedDate}"></span></div>
                    </div>

                    <div class="transaction-item">
                        <!--<img alt="Image" class="cmr" th:src="@{/images/iconcmr.svg}">
                        <label>Commerçant</label>-->
                        <div class="icondetails"><img alt="Image" class="dets" th:src="@{/images/iconetcmr.svg}"></div>
                        <div class="value"><span >Pathé Californie Casablanca</span></div>
                    </div>

                    <div class="transaction-item">
                        <!--<img alt="Image" class="site" th:src="@{/images/iconsite.svg}">
                        <label>Site web</label>-->
                        <div class="icondetails"><img alt="Image" class="dets" th:src="@{/images/iconetsite.svg}"></div>
                        <div class="value"><span >www.pathe.ma</span></div>
                    </div>

                    <div class="transaction-item">
                        <!--<img alt="Image" class="comd" th:src="@{/images/iconcomd.svg}">
                        <label>Commande</label>-->
                        <div class="icondetails"><img alt="Image" class="dets" th:src="@{/images/iconetcomd.svg}"></div>
                        <div class="value"><span >0292DJ92_9238_S201</span></div>
                    </div>
                </div>
            </div>
        </div>


        <!-- SECTION DROITE -->
        <div class="col-md-8 col-12 payment-panel d-flex flex-column justify-content-center align-items-center">
            <div class="formm">
                <div class="payment-header">
                    <div class="icon-container">
                        <img alt="frame" class="frame" th:src="@{/images/frame.svg}">
                    </div>
                    <div class="text-container">
                        <h3>Informations de paiement</h3>
                        <p>Entrez vos informations de paiement pour valider votre achat.</p>
                    </div>
                </div>

                <form method="post" th:action="@{/processpayment}" th:object="${demandeDto}">

                    <!-- Affichage du message d'erreur -->
                    <div th:if="${session.error}" id="error-message">
                        <img alt="Image" id="alert-circle" th:src="@{/images/alert-circle.svg}">
                        <span th:text="${session.error}"></span>
                    </div>

                    <div class="form-group">
                        <label class="labInput">Nom sur la carte</label>
                        <input class="form-control" id="nomSurCarte" placeholder="Entrez le nom du porteur de la carte" required="required" type="text">
                    </div>

                    <!-- Affichage de la liste déroulante si des cartes existent -->
                    <!--                    <div id="cardSelectDiv" th:if="${demandeDto.cartes != null and #lists.size(demandeDto.cartes) > 0}" class="form-group">-->
                    <!--							<label class="labInput">Informations de votre carte</label>-->

                    <!--                        <select id="selectCard" th:field="*{demPan}" onchange="updateCardDetails()" class="form-control">-->
                    <!--                            <option value="">Sélectionnez une carte</option>-->
                    <!--                            <option th:each="carte : ${demandeDto.cartes}"-->
                    <!--                                    th:value="${carte.carte}"-->
                    <!--                                    th:data-year="${carte.year}"-->
                    <!--                                    th:data-month="${carte.moisValue}">-->
                    <!--                                    <span th:text="${carte.pcidsscarte}"></span>-->
                    <!--                                    <span th:text="${carte.moisValue + '/' + #strings.substring(carte.year, 2, 4)}"></span>-->
                    <!--                            </option>-->
                    <!--                            <option value="newCard">Utiliser une nouvelle carte</option>-->
                    <!--                        </select>-->
                    <!--                    </div>-->















                    <label class="labInput">Informations de votre carte</label>
                    <div id="cardSelectDiv" th:if="${demandeDto.cartes != null and #lists.size(demandeDto.cartes) > 0}" class="form-group custom-dropdown">
                        <!-- Selected card display -->
                        <div id="selectedCard" class="selected-card" onclick="toggleDropdown()">
                            <span id="selectedText">Sélectionnez une carte</span>
                            <img  id="card-logo2" >
                            <img alt="Image" id="selectCardArrow" th:src="@{/images/arrow.svg}" class="rotate-180">
                        </div>

                        <!-- Dropdown list -->
                        <!-- Dropdown list -->
                        <div id="dropdownList" class="dropdown-list" style="display:none; max-height:300px; overflow-y:auto; border:1px solid #ccc; background:#fff; position:absolute; width:100%; z-index:1000;">
                            <div class="dropdown-item" data-value="" data-brand="" onclick="selectCardDefault(this)">
	                   <span style="
	                               height: 36;
	                               border-radius: radius-sm;
	                               padding-top: spacing-md;
	                               padding-right: 10px;
	                               padding-bottom: spacing-md;
	                               padding-left: 0px;">
	                               Vos cartes enregistrées
	                       </span>
                            </div>

                            <div th:each="carte : ${demandeDto.cartes}"
                                 class="dropdown-item"
                                 th:data-value="${carte.carte}"
                                 th:data-brand="${carte.scheme}"
                                 th:data-year="${carte.year}"
                                 th:data-month="${carte.moisValue}"
                                 onclick="selectCard(this)"
                                 style="cursor:pointer; display: flex; align-items: center; padding:8px 10px; position:relative;">

                                <!-- ✅ Checkmark container -->
                                <span class="checkmark" style="margin-right: 8px; width: 16px;"></span>

                                <!-- Card brand icon -->
                                <img th:src="@{/images/} + ${carte.scheme} + '.svg'"
                                     alt="card logo"
                                     style="width: 24px; height: auto; margin-right: 10px;" />

                                <!-- Card number -->
                                <span class="card-number" style="font-size: 1.1rem; font-family: 'Courier New', monospace;">
				        <span th:text="${#strings.substring(carte.pcidsscarte, 0, 4) + ' '
				                      + #strings.substring(carte.pcidsscarte, 4, 6) + '** **** '
				                      + #strings.substring(carte.pcidsscarte, carte.pcidsscarte.length() - 4)}"></span>
				    </span>

                                <!-- Expiration -->
                                <span style="margin-left: 10px; color: #667085; font-size: 0.95rem;"
                                      th:text="${carte.moisValue + '/' + #strings.substring(carte.year, 2,4)}">
				    </span>

                                <!-- Trash icon -->
                                <img src="/images/trashIcon.svg" alt="Supprimer"
                                     onclick="event.stopPropagation(); removeCard(this)"
                                     style="margin-left: auto; margin-right: 10px; width: 24px; height: 24px; cursor: pointer;" />
                            </div>

                            <div class="dropdown-item" data-value="" data-brand="" onclick="selectCard(this)" style="cursor:pointer; padding:8px 10px;">
                                <img src="/images/nvcarte.svg" alt="New Card" style="                                               font-family: Font family/font-family-body;
				                                               font-weight: 600;
				                                               font-size: Font size/text-sm;
				                                               line-height: Line height/text-sm;
				                                               letter-spacing: 0%;
				">
                                Utiliser une nouvelle carte
                            </div>
                        </div>

                    </div>
                    <input type="hidden" th:field="*{demPan}" id="hiddenInput" />


































                    <!-- Input caché si des cartes existent -->
                    <div th:if="${demandeDto.cartes == null or #lists.size(demandeDto.cartes) == 0}" class="form-group numcarte">
                        <input id="num" oninput="checkCardType('num', 'card-logo')" placeholder="1234 1234 1234 1234" required="required"
                               th:field="*{demPan}" type="text">
                        <img alt="Image" id="card-logo" th:src="@{/images/visa_mc.svg}">
                    </div>
                    <!-- Input caché si des cartes existent -->
                    <div id="newCardDiv" class="form-group numcarte1 " style="display: none !important;">
                        <input class="form-control" id="nvnum" oninput="checkCardType('nvnum', 'card-logo1')" placeholder="1234 1234 1234 1234"
                               th:field="*{demPan}" type="text">
                        <img alt="Image" id="card-logo1" th:src="@{/images/visa_mc.svg}">
                    </div>
                    <div class="form-group d-flex gap-2">
                        <div class="mr-2" style="width: 50%">
                            <input class="form-control" id="dateExp" placeholder="MM/AA" th:field="*{expery}" type="text">
                        </div>
                        <div class="cvc" style="width: 50%">
                            <input class="form-control" id="cvv" placeholder="CVC" required="required" th:field="*{demCvv}" type="number">
                            <img alt="Image" id="cvc-logo" th:src="@{/images/cvc.svg}">
                        </div>
                    </div>
                    <div class="custom-checkbox-container">
                        <input type="checkbox" id="terms" required />
                        <label class="custom-checkbox-label" for="terms">
                            <span class="custom-checkbox"></span>
                            J'ai lu et j'accepte les
                            <span class="terms-link" onclick="openModal()">conditions générales </span>
                            <span class="terms-link" onclick="openModal()">d'utilisation.</span>
                        </label>
                    </div>

                    <div class="modal-overlay" id="termsModal">
                        <div class="modal-content">
                            <span class="modal-close" onclick="closeModal()">&times;</span>
                            <h3>Conditions générales d'utilisation</h3>
                            <p>
                                Conformément à la loi 09-08 sur la protection des personnes physiques à l'égard du traitement des données à caractère personnel, il est porté à votre connaissance qu'en utilisant le service de paiement en ligne pour payer un service ou un produit commercialisé par un site marchand affilié à NAPS :
                            </p>
                            <ul>
                                <li>Les destinataires des données concernant un payeur telles que le nom et prénom, courriel, adresse et numéro de téléphone, à l'exception des données bancaires confidentielles, et qui sont soit transmises par le site Marchand à NAPS ou saisies par le payeur sur l'écran de paiement mis à sa disposition par NAPS pour le compte de l'e-commerçant et sous son ordre, pourront être utilisées par les collaborateurs de NAPS responsables du traitement, dont la finalité est le suivi de l'opération de paiement initiée par le payeur sur le site Marchand.</li>
                                <li>Les destinataires des données bancaires qui sont saisies par le payeur sur l'écran de paiement mis à sa disposition par NAPS pour le compte de l'e-commerçant et sous son ordre, pourront être utilisées par les systèmes d'information et monétiques de NAPS, ainsi que le système monétique de la banque marocaine ou internationale émettrice de la carte bancaire utilisée lors du paiement en ligne. Toutes ces entités sont responsables, chacune suivant ses attributions, du traitement dont la finalité est le traitement de l'opération de paiement initiée par le payeur sur le site marchand.</li>
                                <li>Les données recueillies par NAPS ne peuvent être utilisées à des fins de prospection par ce dernier et sont la propriété de l'e-commerçant qui a délégué la gestion du paiement de son site marchand à NAPS.</li>
                                <li>Vous disposez d'un droit d'accès en consultation à vos données personnelles traitées par NAPS et qui figurent dans votre reçu de paiement, à l'exception des données bancaires, en contactant NAPS par courrier à l'adresse suivante : NAPS - 16, rue Ibn Khalikane, Palmiers, Casablanca.</li>
                                <li>Vous pouvez aussi accéder à ces données depuis le reçu de paiement ou de transaction mis à votre disposition par courriel et en ligne par NAPS ou l'e-commerçant.</li>
                            </ul>
                        </div>
                    </div>


                    <!-- Sauvegarder la carte -->
                    <div class="form-group custom-checkbox-wrapper" th:if="${demandeDto.idClient != null}">
                        <input type="checkbox" id="svCarte" th:field="*{flagSaveCarte}" />
                        <label for="svCarte" class="d-flex align-items-center" style="cursor:pointer;">
                            <span class="custom-checkbox-style"></span>
                            <span class="custom-checkbox-label-text ml-2">Enregistrer cette carte pour mes prochains paiements</span>
                        </label>
                    </div>
                    <input type="hidden" th:field="*{commande}" class="form-control">
                    <input type="hidden" th:field="*{comid}" class="form-control">
                    <input type="hidden" th:field="*{galid}" class="form-control">
                    <input type="hidden" th:field="*{montant}" class="form-control">
                    <input type="hidden" th:field="*{iddemande}" class="form-control">
                    <input type="hidden" th:field="*{tokencommande}" class="form-control">
                    <input type="hidden" th:field="*{failURL}" class="form-control">

                    <div class="form-group text-center">
                        <button class="subscribe-btn">
                            <img alt="flch" class="flch" th:src="@{/images/flechpayer.svg}">
                            <span class="payer">Payer</span>
                            <span class= "montant" th:text="${demandeDto.montantStr}"></span>
                            <span class="curr">DH</span>
                        </button>
                    </div>
                    <div class="form-group d-flex align-items-center lock-label">
                        <img alt="lock" class="lock" th:src="@{/images/lock.svg}">
                        <label class="mb-0 sec" for="terms">Toutes vos données personnelles sont chiffrées et
                            sécurisées</label>
                    </div>
                </form>
            </div>
            <div class="footer-container">
                <div class="footer-content">
                    <div class="d-none d-md-inline">
                            <span class="textFooter">Powered by
                                <a href="https://www.naps.ma" target="_blank">
                                    <img alt="NAPS" class="powered" th:src="@{/images/powered_naps.svg}">
                                </a>
                                <!--<img alt="Image" class="powered" th:src="@{/images/powered_naps.svg}">-->
                            </span>
                        <!--                        <span class="separator">|</span>-->
                        <!--                        <span class="textFooter">Politique de confidentialité</span>-->
                        <!--                        <span class="separator"><i class="fas fa-circle" style="font-size: xx-small;"></i></span>-->
                        <!--                        <span class="textFooter">Conditions générales</span>-->
                    </div>
                    <div class="d-inline d-md-none text-center">
                            <span class="textFooter">Powered by
                                <img alt="Image" class="powered" th:src="@{/images/powered_naps.svg}">
                            </span><br>
                        <!--                        <div class="policy-links">-->
                        <!--                            <span class="textFooter">Politique de confidentialité</span>-->
                        <!--                            <span class="separator"><i class="fas fa-circle"-->
                        <!--                                                       style="font-size: xx-small;"></i></span>-->
                        <!--                            <span class="textFooter">Conditions générales</span>-->
                        <!--                        </div>-->
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>


<div id="confirmDeleteModal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background-color: rgba(0,0,0,.6); z-index: 9999; justify-content: center; align-items: center;">

    <div style="background: white; border-radius: 12px; padding: 24px; width: 400px; text-align: center; position: relative;">
        <button onclick="closeModal()" style="color : #A4A7AE;position: absolute; top: 10px; right: 10px; border: none; background: none; font-size: 18px;">X</button>

        <div style="font-size: 44px; color: #fd7e14;">
            <img alt="Image" class="powered" th:src="@{/images/removeCard.svg}">
        </div>
        <h3 style="margin-top: 16px;font-size: 1.3rem;">Supprimer cette carte bancaire?</h3>
        <p style="font-size: .8rem; color : #535862;">Êtes-vous sûr(e) de vouloir supprimer cette carte ?</p>

        <div style="margin-top: 24px; display: flex; justify-content: space-around;">
            <button onclick="closeModal()" style="padding: 8px 16px; border: 1px solid #ccc; background: white; border-radius: 6px;">Annuler</button>
            <button onclick="confirmDeleteCard()" style="Font family/font-family-body;padding: 8px 16px; background: #D92D20; color: white; border: none; border-radius: 6px;">Supprimer</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>


    function toggleDropdown() {
        const dropdown = document.getElementById('dropdownList');
        const arrow = document.getElementById("selectCardArrow");

          if (dropdown.style.display === "none" || dropdown.style.display === "") {
            dropdown.style.display = "block";
            arrow.classList.remove("rotate-180");
            arrow.classList.add("rotate-0");
          } else {
            dropdown.style.display = "none";
            arrow.classList.remove("rotate-0");
            arrow.classList.add("rotate-180");
          }
    }

    function selectCard(element) {
        const value = element.getAttribute('data-value');
        const brand = element.getAttribute('data-brand');
        const year = element.getAttribute('data-year');
        const month = element.getAttribute('data-month');
        var cardSelectDiv = document.getElementById("cardSelectDiv");
        var dropdownList = document.getElementById("dropdownList");
        var selectedCard = document.getElementById("selectedCard");
        var newCardDiv = document.getElementById("newCardDiv");
        var dateExp = document.getElementById("dateExp");
        var cvv = document.getElementById("cvv");
        const text = element.innerText.trim();

        // Update selected display
        const selectedText = document.getElementById('selectedText');
        const selectedCardIcon = document.getElementById('card-logo2');
        selectedText.textContent = value;
        console.log(brand);
        if (brand) {
            selectedCardIcon.src= '/images/'+brand+'.svg';
        } else {
            selectedCardIcon.src= 'none';
            cardSelectDiv.style.display = 'none';
            /*toggleDropdown();
            selectedCard.style.display = 'none';
            dropdownList.style.display = 'none';*/
            newCardDiv.style.display = 'block';
            dateExp.value = '';
            cvv.value = '';
        }

        // Remplir automatiquement la date d'expiration
        if (year && month) {
            document.getElementById("dateExp").value = month + " / " + year.toString().slice(-2);
        }

        // Update hidden input (form value)
        document.getElementById('hiddenInput').value = value;

        const items = document.querySelectorAll('.dropdown-item');
        items.forEach(item => item.classList.remove('selected'));

        // Add to current one
        element.classList.add('selected');

        // Optionally set selected values in hidden fields or do other logic
        const selectedCardNumber = element.dataset.value;
        console.log("Selected card:", selectedCardNumber);

        // Close dropdown
        toggleDropdown();
    }

    // Close dropdown if clicked outside
    document.addEventListener('click', function(event) {
        const container = document.getElementById('cardSelectDiv');
        if (container && !container.contains(event.target)) {
            document.getElementById('dropdownList').style.display = 'none';
        }
    });

    function selectCardDefault(element) {
        const value = element.getAttribute('data-value');
        const brand = element.getAttribute('data-brand');
        const year = element.getAttribute('data-year');
        const month = element.getAttribute('data-month');
        var cardSelectDiv = document.getElementById("cardSelectDiv");
        var dropdownList = document.getElementById("dropdownList");
        var selectedCard = document.getElementById("selectedCard");
        selectedCard.style.display === "block"
        dropdownList.style.display === "none"
        var newCardDiv = document.getElementById("newCardDiv");
        var dateExp = document.getElementById("dateExp");
        var cvv = document.getElementById("cvv");
        const text = element.innerText.trim();

        // Update selected display
        const selectedText = document.getElementById('selectedText');
        const selectedCardIcon = document.getElementById('card-logo2');
        selectedText.textContent = "Sélectionnez une carte";
        selectedCardIcon.src= '';
        selectedCardIcon.alt= '';
        dateExp.value = '';
        cvv.value = '';
        toggleDropdown();
    }

    function updateCardDetails() {
    var select = document.getElementById("selectCard");
    var selectedOption = select.options[select.selectedIndex];
    var newCardDiv = document.getElementById("newCardDiv");
    var cardSelectDiv = document.getElementById("cardSelectDiv");
    var dateExp = document.getElementById("dateExp");
    var cvv = document.getElementById("cvv");
    console.log('selectedOption : ' + selectedOption.value);

    // Récupérer l'année système
    var currentYear = new Date().getFullYear();
    var maxYear = currentYear + 10; // Année max = année actuelle + 10 ans
    console.log('currentYear :', currentYear);

    if (selectedOption.value === 'newCard') {
        // Afficher le champ de saisie et masquer la liste des cartes
        cardSelectDiv.style.display = 'none';
        newCardDiv.style.display = 'block';
        dateExp.value = '';
        cvv.value = '';
    } else {
        // Récupérer les valeurs associées à la carte sélectionnée
        var year = selectedOption.getAttribute("data-year");
        var month = selectedOption.getAttribute("data-month");

        // Remplir automatiquement la date d'expiration
        if (year && month) {
            document.getElementById("dateExp").value = month + " / " + year.toString().slice(-2);
        }
    }
}

document.addEventListener("DOMContentLoaded", function () {
    const dateExp = document.getElementById("dateExp");
    console.log("1418");
    dateExp.addEventListener("input", function (e) {
        let value = this.value.replace(/\D/g, ''); // Ne garder que les chiffres
        if (value.length > 4) value = value.slice(0, 4); // max 4 chiffres

        // Format MM / YY
        if (value.length >= 2) {
            this.value = value.slice(0, 2) + " / " + value.slice(2);
        } else {
            this.value = value;
        }
    });

    // Permet de supprimer le "/"
    dateExp.addEventListener("keydown", function (e) {
        console.log("1435");
        // Si on est juste après le slash et qu'on appuie sur Backspace
        if (e.key === "Backspace" && this.selectionStart === 6 && this.value.charAt(3) === '/') {
            console.log("backspace");
            this.value = this.value.slice(0, 2); // Supprime le slash
            this.setSelectionRange(4, 4); // Replace le curseur
            e.preventDefault();
        }
    });
});

    let panelState = 0;
    // 0 = état initial, 1 = ouvert complètement
    function togglePanel() {
        let panel = document.querySelector(".left-panel");
        let details = document.querySelector(".left-panel .details");
        let flechDown = document.querySelector(".flech.down");
        let flechUp = document.querySelector(".flech.up");

        if (window.innerWidth <= 768) {
            if (panelState === 0) {
                // 1er clic : Ouvrir complètement
                panel.style.top = "0px";
                details.style.display = "block";
                panelState = 1;
                // Afficher la flèche haut et cacher la flèche bas
                flechDown.classList.add("d-none");
                flechUp.classList.remove("d-none");
            } else {
                // 2ème clic : Revenir à l’état initial (partiellement visible)
                panel.style.top = "0px"; // Ajusté pour voir le h2
                details.style.display = "none";
                panelState = 0;
                // Afficher la flèche bas et cacher la flèche haut
                flechDown.classList.remove("d-none");
                flechUp.classList.add("d-none");
            }
        }
    }
    window.addEventListener('DOMContentLoaded', function () {
            const errorMessage = document.getElementById('error-message');
            if (errorMessage) {
                console.log('errorMessage true');
                const fields = document.querySelectorAll('input, select');
                fields.forEach(field => {
                    field.addEventListener('input', () => errorMessage.style.display = 'none');
                    field.addEventListener('change', () => errorMessage.style.display = 'none');
                });
            } else {
                console.log('errorMessage false');
             }
        });

document.getElementById("dateExp").addEventListener("input", function (e) {
    console.log("1488");
    // Supprime tous les caractères non numériques
    let value = e.target.value.replace(/\D/g, "");
    console.log("value = "+value);
     // Limite à 4 chiffres max (MMYY)
    if (value.length > 4) {
        value = value.substring(0, 4);
    }

    // Traitement du mois
    if (value.length >= 1) {
        let month = value.substring(0, 2);

        // Si 1 chiffre, on attend encore, sauf si > 1 (ex: "3" => "03")
        if (value.length === 1 && parseInt(month) > 1) {
            month = "0" + month;
            value = month;
        }

        // Si 2 chiffres ou plus, valider mois entre 01-12
        if (value.length >= 2) {
            let mm = parseInt(month);
            if (mm < 1) mm = 1;
            if (mm > 12) mm = 12;

            month = mm.toString().padStart(2, "0");
            value = month + value.substring(2);
        }
    }

    // Ajout du séparateur " / " immédiatement après les deux premiers chiffres
    if (value.length >= 2 && value.length <= 4) {
        value = value.substring(0, 2) + " / " + value.substring(2);
    }

    // Limite l'affichage à 7 caractères max (MM / YY)
    if (value.length > 7) {
        value = value.substring(0, 7);
    }

    e.target.value = value;
});

     validateInputField('cvv', 3);
     validateInputField('num', 19);
     validateInputField('nvnum', 19);
     validateInputField('nomSurCarte', 40);

     // Limit input field length and allow only numeric values
     function validateInputField(elementId, maxLength) {
        const element = document.getElementById(elementId);
        if (element) {
           element.addEventListener('input', function () {
              this.value = this.value.slice(0, maxLength).replace(/[^0-9]/g, "");
           });
        } else {
           console.log(`Element with ID '${elementId}' not found for validation.`);
        }
     }

function checkCardType(idCarte, logo) {
    const input = document.getElementById(idCarte);
    const cardLogo = document.getElementById(logo);

    // Supprimer l'attribut "oninput" après la première exécution pour éviter la boucle infinie
    input.removeAttribute("oninput");

    // Écouteur permanent à partir de maintenant
    input.addEventListener('input', function () {
        let value = input.value.replace(/\D/g, '');

        // Ajoute un espace après chaque 4 chiffres
        value = value.replace(/(.{4})/g, '$1 ').trim();
        input.value = value;

        let cardNumber = value.replace(/\s/g, '');

        if (cardNumber.startsWith('4')) {
            cardLogo.style.display = 'block';
            cardLogo.src = '/images/icon_visa.svg';
        } else if (cardNumber.startsWith('5') || cardNumber.startsWith('2')) {
            cardLogo.style.display = 'block';
            cardLogo.src = '/images/icon_mc.svg';
        } else {
            //cardLogo.src = '/images/visa_mc.svg';
            cardLogo.style.display = 'none';
        }

    });

    // Appeler une seule fois l’écouteur avec la première valeur (déclenche dès la première saisie)
    input.dispatchEvent(new Event('input'));
}


    window.onload = function() {
          const iddemande = document.getElementById('iddemande');
          const commande = document.getElementById('commande');
          const inputs = document.querySelectorAll('input'); // Sélectionner tous les champs de saisie
          const selects = document.querySelectorAll('select'); // Sélectionner tous les éléments <select>


          // Fonction à appeler quand l'utilisateur touche ou fait défiler la page
          function check() {
              if (iddemande && commande && iddemande.value.trim() !== '' && commande.value.trim() !== '') {
                  console.log("La page est visible, l'utilisateur interagit.");

                  // Effectuer un appel AJAX
                  fetch('/check', {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json'
                      },
                      body: JSON.stringify({
                          iddemande: iddemande.value,
                          commande: commande.value
                      })
                  })
                  .then(response => response.json())
                  .then(data => {
                      console.log("Réponse du serveur :", data);
                  })
                  .catch(error => console.error("Erreur AJAX :", error));
              } else {
                  console.error("Les champs iddemande ou commande sont vides ou introuvables. L'appel AJAX n'a pas été effectué.");
              }
          }

          // Appel initial de check() dès que la page est chargée
          // check();

          // Vérifie si la page est visible (avec l'événement `touchstart` pour mobile et `scroll` pour mobile/desktop)
          function handleUserInteraction() {
              // Si un utilisateur touche ou fait défiler, on appelle la fonction check
              check();
          }

          // Écouter l'événement `touchstart` (sur mobile et tablette)
          document.addEventListener('touchstart', handleUserInteraction, { once: true });

         // Écouter l'événement de clic sur tous les champs input (mobile/desktop)
          inputs.forEach(input => {
              input.addEventListener('click', handleUserInteraction);
          });
           // Écouter l'événement de clic sur tous les éléments <select>
          selects.forEach(select => {
              select.addEventListener('click', handleUserInteraction);
          });

          // Écouter l'événement `scroll` (sur desktop et mobile)
          window.addEventListener('scroll', handleUserInteraction, { once: true });
      };


      let cardToDelete = null;

      function removeCard(icon) {
        cardToDelete = icon.closest('.dropdown-item'); // store the card div
        document.getElementById('confirmDeleteModal').style.display = 'flex'; // show modal
      }

      function closeModal() {
        document.getElementById('confirmDeleteModal').style.display = 'none';
        cardToDelete = null;
      }

      function confirmDeleteCard() {
        if (cardToDelete) {
          cardToDelete.remove();
          // You can call an AJAX request to delete it on the server too.

        // Show success popup
           Swal.fire({
            imageUrl: '/images/success.svg', // 🔁 your icon path here
             imageWidth: 60,
             imageHeight: 60,
             title: 'Carte supprimée avec succès',
             showConfirmButton: false,
             timer: 1000,
             toast: true,
             position: 'top',
             customClass: {
               popup: 'swal-toast'
             }
           });
        }



        closeModal();
      };




      /*function removeCard(icon) {
        const card = icon.closest('.dropdown-item');

        Swal.fire({
          title: 'Supprimer cette carte bancaire?',
          text: "Êtes-vous sûr(e) de vouloir supprimer cette carte ?",
          icon: 'warning',
          width: 400,
          height: 230,
          top: 299,
          left: 556,
          showCancelButton: true,
          confirmButtonText: 'Supprimer',
          cancelButtonText: 'Annuler',
          confirmButtonColor: '#dc3545',
        }).then((result) => {
          if (result.isConfirmed) {
            card.remove(); // Or call API to delete
          }
        });
      }*/
      function openModal() {
              document.getElementById("termsModal").style.display = "block";
          }

          function closeModal() {
              document.getElementById("termsModal").style.display = "none";
          }

          // Optional: Close on ESC
          window.addEventListener("keydown", function (e) {
              if (e.key === "Escape") closeModal();
          });

          // Optional: Close on outside click
          document.getElementById("termsModal").addEventListener("click", function (e) {
              if (e.target === this) closeModal();
          });
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>
